<?php

function afrikaburn_form_volunteer_registration_form_node_form_alter (&$form, &$form_state, $form_id) {
  
  if (!isset($form_state['node']->nid)) {
    global $user;
    $existing_nid = db_query(
      "SELECT nid FROM {node} WHERE (type = :type) AND uid = :uid", 
      array(
        "type" => "volunteer_registration_form",
        "uid" => $user->uid
      )
     )->fetchField();
    if ($existing_nid != FALSE) {
      drupal_goto("node/$existing_nid/edit");
    }
  }
}

function afrikaburn_form_sanctuary_services_application_form_node_form_alter (&$form, &$form_state, $form_id) {
  
  if (!isset($form_state['node']->nid)) {
    global $user;
    $existing_nid = db_query(
      "SELECT nid FROM {node} WHERE (type = :type) AND uid = :uid", 
      array(
        "type" => "sanctuary_services_application",
        "uid" => $user->uid
      )
     )->fetchField();
    if ($existing_nid != FALSE) {
      drupal_goto("node/$existing_nid/edit");
    }
  }
}

function afrikaburn_form_volunteer_early_access_node_form_alter (&$form, &$form_state, $form_id) {
  
  if (!isset($form_state['node']->nid)) {
    global $user;
    $user_fields = user_load($user->uid);
    
    $volunteers = array(
                  'alastair@afrikaburn.com','aislinntudhope@gmail.com','alabandit@gmail.com','alexandra.lacroix@espeme.com','angelica.e.lambert@gmail.com','anita.branco@gmail.com','ankejabroer@gmail.com','ann@anngadd.co.za','ant@gadd-art.co.za','ashlee60@hotmail.com','bauke@live.com','bebbo@bebbo.it','belinda.vanrensburg1313@gmail.com','bigwords99@gmail.com','bjlittle27@gmail.com','bobbyf@whizprop.co.za','brentrubin@hotmail.com','burgher4king@gmail.com','cari@tortilis.co.za','chris@autoexposed.co.za','chulki.87@mail.ru','cilmapret@gmail.com','clara.fouilland@sciencespo.fr','crochaus@eject.co.za','daniel.ross.dekock@gmail.com','dawn@animaltherapy.co.za','dax@scholtz.com.au','dejonge@intekom.co.za','devin.isaacs@gmail.com','dillonj@live.co.za','domenic.lindenmeir@gmx.de','e_woodward@hotmail.co.uk','ematterbury@gmail.com','emilieharmsberlin@gmail.com','evilbelgian@gmail.com','franklychilli@gmail.com','frithcolin@gmail.com','fruitoftheforest@gmail.com','g.chefl@gmx.de','gedwardsrealtor@yahoo.com','gnettleton@gmail.com','gnv05jacqueline.lu.se@gmail.com','heidiraubenheimer@gmail.com','howardgasman@gmail.com','ilineceelen@gmail.com','info@envirowatch.co.za','jacqui.woolfson@gmail.com','jano1385@gmail.com','jeremywalter3@gmail.com','jess.df@hotmail.com','jjpstalbans@gmail.com','joey@gouws.co.za','Johan.stadler@fnb.co.za','joseph.meyerowitz@gmail.com','jteeemd@sbcglobal.net','julius65@mweb.co.za','kellylouiseatkins@googlemail.com','krazyjey@gmail.com','krivett@medivision.co.za','kuhlmannnora@gmail.com','kylehansen69@yahoo.com','leebutorac@gmail.com','lehlogonolomalatje@gmail.com','leonie@scorched.co.za','leonpatras@gmail.com','linnea@telkomsa.net','lizelleharper@yahoo.com','louis@cellublitz.co.za','louw.morne@gmail.com','madeleine.cake@yahoo.com','mail@sarahcan.co.za','malilimalo4@gmail.com','manonarmstrong@gmail.com','marco@dynasoft.co.za','markw@alleycatcoffeehouse.com','maximsomin@gmail.com','maxpittich@mweb.co.za','metlmania@telkomsa.net','mfolokeletso1@gmail.com','misbehaviour@live.com','natashareynolds0@gmail.com','nicholas@wallander.co.za','paulnieuw1@gmail.com','powerflower888@gmail.com','ralphcopeiv@gmail.com','rjforssman111@gmail.com','robndawn@gmail.com','ronell.wiid@gmail.com','rpsabrey@gmail.com','ruud.vdl@gmail.com','ryna.chan@gmail.com','sallyb143@gmail.com','scott.macbeth@gmail.com','sherries@mweb.co.za','sherriharmer@hotmail.co.za','shireenm1@gmail.com','stephanie_f@live.co.za','stofkind@gmail.com','stormferreira@hotmail.com','suzierivett@gmail.com','taryn.ward@gmail.com','theo@wasteplan.co.za','timclombard@gmail.com','tsibiya69@gmail.com','tuddy@protonmail.com','ulyana89@mail.ru','verheuljess@gmail.com','weber@directcon.net','weise_max@yahoo.de','wendela.meijer@gmail.com','wildup@earthling.net','yannickvanw@hotmail.com'
                  );
    
    
    if ( in_array($user_fields->mail, $volunteers) ) {
    //goo to page
    
       $existing_nid = db_query(
        "SELECT nid FROM {node} WHERE (type = :type) AND uid = :uid", 
        array(
          "type" => "volunteer_early_access",
          "uid" => $user->uid
        )
       )->fetchField();
      if ($existing_nid != FALSE) {
        drupal_set_message('Please note you can only apply for one early access ticket. If you know other people needing tickets they will need to apply for them selves.');
        drupal_goto("node/$existing_nid/edit");
      } 
    } else {
      drupal_set_message("Volunteer early access is locked to Burner Bio's. Please login in with a Burner Bio that is linked to your volunteer shifts on Signup Genius.", 'error');
      drupal_goto("/");
    }
  }
}

function afrikaburn_form_voluntary_medical_information_form_node_form_alter (&$form, &$form_state, $form_id) {
  
  if (!isset($form_state['node']->nid)) {
    global $user;
    $existing_nid = db_query(
      "SELECT nid FROM {node} WHERE (type = :type) AND uid = :uid", 
      array(
        "type" => "voluntary_medical_information",
        "uid" => $user->uid
      )
     )->fetchField();
    if ($existing_nid != FALSE) {
      drupal_goto("node/$existing_nid/edit");
    }
  }
}
